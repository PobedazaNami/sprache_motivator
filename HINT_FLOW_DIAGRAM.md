# Hint Feature Flow Diagram

## User Flow Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Training Task Sent                        â”‚
â”‚                                                               â”‚
â”‚  ğŸ¯ Task 1/3 for today                                       â”‚
â”‚  ğŸ“š Level: A2 | Topic: Family and friends                   â”‚
â”‚                                                               â”‚
â”‚  Translate this sentence:                                    â”‚
â”‚  I like to play football with my friends.                   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚   ğŸ’¡ ĞÑ‚Ñ€Ğ¸Ğ¼Ğ°Ñ‚Ğ¸ Ğ¿ĞµÑ€ĞµĞºĞ»Ğ°Ğ´ / Get Hint  â”‚  â† Hint Button     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                             â”‚
         â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Types     â”‚          â”‚  User Clicks     â”‚
â”‚  Answer         â”‚          â”‚  Hint Button     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                            â”‚
         â”‚                            â”‚
         â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Check Answer   â”‚          â”‚  Show Translation Hint       â”‚
â”‚                 â”‚          â”‚                              â”‚
â”‚  âœ… or âŒ       â”‚          â”‚  ğŸ’¡ ĞŸÑ–Ğ´ĞºĞ°Ğ·ĞºĞ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ°!    â”‚
â”‚  Quality: X%    â”‚          â”‚                              â”‚
â”‚                 â”‚          â”‚  âœï¸ Correct translation:    â”‚
â”‚  Update Stats:  â”‚          â”‚  Ich spiele gerne...         â”‚
â”‚  âœ“ completed    â”‚          â”‚                              â”‚
â”‚  âœ“ quality      â”‚          â”‚  âš ï¸ This task doesn't count â”‚
â”‚  âœ“ correct/     â”‚          â”‚  in daily statistics but is  â”‚
â”‚    incorrect    â”‚          â”‚  tracked as 'hint activation'â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                            â”‚
         â”‚                            â”‚
         â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Daily Stats    â”‚          â”‚  Hint Tracking               â”‚
â”‚  MongoDB        â”‚          â”‚  MongoDB                     â”‚
â”‚                 â”‚          â”‚                              â”‚
â”‚  completed: +1  â”‚          â”‚  hint_activations: +1        â”‚
â”‚  quality: +X    â”‚          â”‚                              â”‚
â”‚  correct/       â”‚          â”‚  completed_tasks: unchanged  â”‚
â”‚  incorrect: +1  â”‚          â”‚  quality_sum: unchanged      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Database Structure Comparison

### Regular Answer (Counts in Stats)
```javascript
daily_stats: {
  user_id: 12345,
  date: "2025-11-18",
  
  // These are updated when user answers
  completed_tasks: 1,        // â† Incremented
  quality_sum: 85,           // â† Added
  correct_answers: 1,        // â† Incremented (if correct)
  
  // Hint counter unchanged
  hint_activations: 0        // â† Not touched
}
```

### Hint Activated (Separate Counter)
```javascript
daily_stats: {
  user_id: 12345,
  date: "2025-11-18",
  
  // These remain unchanged
  completed_tasks: 0,        // â† Not incremented
  quality_sum: 0,            // â† Not updated
  correct_answers: 0,        // â† Not touched
  
  // Only hint counter updated
  hint_activations: 1        // â† Incremented
}
```

## Code Flow

```
1. send_training_task() in trainer.py
   â”œâ”€â†’ Generate sentence
   â”œâ”€â†’ Get expected translation
   â”œâ”€â†’ Create training session in MongoDB
   â”œâ”€â†’ Send message with hint button
   â”‚   â””â”€â†’ get_trainer_task_keyboard(lang, training_id)
   â””â”€â†’ Store state in Redis: "awaiting_training_answer"

2a. User types answer â†’ check_training_answer()
    â”œâ”€â†’ Get training session from MongoDB
    â”œâ”€â†’ Check translation quality
    â”œâ”€â†’ Update training session
    â”œâ”€â†’ update_daily_stats() with quality
    â””â”€â†’ Clear Redis state

2b. User clicks hint â†’ show_hint()
    â”œâ”€â†’ Extract training_id from callback
    â”œâ”€â†’ Get training session from MongoDB
    â”œâ”€â†’ Show expected_translation
    â”œâ”€â†’ track_hint_activation(user_id)
    â”‚   â””â”€â†’ MongoDB: $inc hint_activations
    â””â”€â†’ Clear Redis state
```

## Statistics Separation Logic

### Daily Report Calculation
```python
# Completed tasks only include answered tasks
completed = doc.get("completed_tasks", 0)  # Excludes hints

# Average quality from answered tasks only
avg_quality = quality_sum / max(1, completed)  # Based on answers

# Hints are tracked separately
hints = doc.get("hint_activations", 0)  # Separate metric
```

### Admin Dashboard (Future)
```
User Daily Activity:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š Tasks Sent: 3
âœ… Completed: 2 (66%)
ğŸ’¡ Hints Used: 1
ğŸ“ˆ Avg Quality: 85%
```

## Key Benefits

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Accurate Statistics                          â”‚
â”‚  User's performance metrics reflect actual       â”‚
â”‚  translation ability, not hint usage             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“š Learning Support                             â”‚
â”‚  Users can learn from difficult tasks without    â”‚
â”‚  being penalized in daily statistics             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š Hint Analytics                               â”‚
â”‚  Admins can track which tasks/topics need hints  â”‚
â”‚  to adjust difficulty levels                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ No Pressure                                  â”‚
â”‚  Users feel comfortable knowing they can get     â”‚
â”‚  help when needed                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
